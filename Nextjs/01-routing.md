# 第1章：ルーティングと構成

**この章の目標**  
「どのURLでどの画面が表示されるか」を、Next.jsの**App Router**という仕組みで整理する方法を学びます。  
高校で習った「フォルダ」のイメージで考えるとわかりやすいです。

---

## ルーティングとは？

**ルーティング**とは、「このURL（アドレス）を開いたら、この画面を表示する」という**対応づけ**のことです。

- 例：`https://example.com/about` を開く → 「会社について」のページを表示
- 例：`https://example.com/products/123` を開く → 商品IDが123のページを表示

Next.jsの**App Router**では、**フォルダとファイルの並び方**が、そのままURLの並び方になります。  
「どのファイルを置くか」で「どのURLでどの画面が出るか」が決まります。

---

## 基本ルール：ページは `page.tsx`、レイアウトは `layout.tsx`

Next.jsでは、次の2種類のファイル名が特別な意味を持ちます。

| ファイル名 | 役割 |
|-----------|------|
| **page.tsx** | 「このURLで表示する**メインの画面**」の中身を書くファイル |
| **layout.tsx** | 「このURL以下で共通して使う**外枠**（ヘッダー・フッターなど）」を書くファイル |

- **新しく画面を増やしたいとき** → そのURLに対応するフォルダを作り、その中に **page.tsx** を置く  
- **全ページで共通のヘッダーやメニューを用意したいとき** → **layout.tsx** に書く  

「page = そのページの内容」「layout = 共通の枠」と覚えておきましょう。

---

## フォルダ構成の例

次のようなフォルダ構成にすると、URLと画面の対応はこうなります。

```
app/
├── page.tsx          → トップページ (/)
├── layout.tsx        → 全ページ共通のレイアウト
├── about/
│   └── page.tsx     → /about のページ
└── products/
    ├── page.tsx     → /products のページ（商品一覧）
    └── [id]/
        └── page.tsx → /products/123 のような「商品ごとのページ」
```

- `app/page.tsx` → サイトのトップ（`/`）
- `app/about/page.tsx` → `/about`
- `app/products/page.tsx` → `/products`
- `app/products/[id]/page.tsx` → `/products/1`、`/products/2` など、**動的な番号**に対応

`[id]` のように **角括弧で囲んだフォルダ名** は「ここがURLの一部として数字や文字に変わる」という意味です。  
商品IDやブログの記事IDのように、「1つずつ違うページ」を作るときに使います。

---

## ローディング・エラー・404用のファイル

ユーザーがページを開いたとき、次の3つの「特別な状態」にも対応できるようにしておくと親切です。

| ファイル名 | いつ使われるか |
|-----------|----------------|
| **loading.tsx** | ページのデータや画面を「読み込み中」のとき。スピナーやスケルトン表示を出したいときに使う |
| **error.tsx** | 何かエラーが起きたとき。ユーザーに「問題が起きました」と伝え、対処（再読み込みなど）のボタンを出せる |
| **not-found.tsx** | 存在しないURLにアクセスしたとき（404ページ）。「お探しのページはありません」のような表示にする |

これらは、対応したいフォルダ（URLの範囲）の**同じ階層**に置きます。  
例えば `app/loading.tsx` に置けば、トップ以外のページでも読み込み中はそのUIが使われます。  
`app/products/error.tsx` を置けば、`/products` 以下でエラーが起きたときだけその内容が表示されます。

---

## グルーピング：(marketing) と (app)

サイトによっては、「宣伝・紹介用のページ」と「ログインして使う機能」を分けて作りたいことがあります。  
そんなとき、**URLには出さず、フォルダだけをまとめたい**場合に使うのが **() で囲んだフォルダ名** です。

例：

```
app/
├── (marketing)/       ← URLには出ない。中身のフォルダだけがURLになる
│   ├── page.tsx       → /
│   ├── about/
│   │   └── page.tsx   → /about
│   └── contact/
│       └── page.tsx   → /contact
└── (app)/             ← こちらもURLには出ない
    ├── dashboard/
    │   └── page.tsx   → /dashboard
    └── settings/
        └── page.tsx   → /settings
```

- `(marketing)` や `(app)` は**URLに含まれません**。  
- 開発する側が「このグループはマーケ用」「このグループはアプリ本体」と分けておくための**見た目の整理**です。

---

## 例題：シンプルなページとレイアウト

以下は、トップページと「会社について」ページを用意する最小限の例です。  
**各行にコメント**を付けてあるので、何をしているか追いながら読んでみてください。

### 例題1：共通レイアウト（app/layout.tsx）

```tsx
// これは「レイアウト」＝全ページで共通する外枠のコンポーネントです
export default function RootLayout({
  children,  // ここに、今表示したいページ（page.tsx）の内容が入ります
}: {
  children: React.ReactNode;  // children は「中身」を表す型です
}) {
  return (
    <html lang="ja">
      {/* 全ページで共通の <html> と <body> を用意します */}
      <body>
        {/* ここにヘッダーやナビを置くと、全ページで表示されます */}
        <header style={{ padding: "1rem", borderBottom: "1px solid #ccc" }}>
          サイトのヘッダー（全ページ共通）
        </header>
        {/* children の部分に、各 page.tsx の内容が差し込まれます */}
        <main style={{ padding: "1rem" }}>{children}</main>
      </body>
    </html>
  );
}
```

### 例題2：トップページ（app/page.tsx）

```tsx
// トップページ（URL: /）の内容を定義します
export default function HomePage() {
  return (
    <div>
      <h1>ようこそ</h1>
      <p>このサイトのトップページです。</p>
    </div>
  );
}
```

### 例題3：Aboutページ（app/about/page.tsx）

```tsx
// 「会社について」ページ（URL: /about）の内容を定義します
export default function AboutPage() {
  return (
    <div>
      <h1>会社について</h1>
      <p>私たちの会社の紹介文がここに入ります。</p>
    </div>
  );
}
```

この3つを用意すれば、  
- `/` でトップページ、  
- `/about` で「会社について」ページ  
が表示され、どちらも同じヘッダーとレイアウトで表示されます。

---

## まとめ

- **ルーティング** = 「このURL → この画面」の対応。Next.jsでは**フォルダとファイルの構成**で決まる。
- 新規画面は **page.tsx**、共通の外枠は **layout.tsx** に書く。
- 読み込み中・エラー・404には **loading.tsx** / **error.tsx** / **not-found.tsx** を用意するとよい。
- フォルダ名を **(名前)** にすると、URLには出さずにグルーピングだけできる。

次章では、**Server Component** と **Client Component** の違いを、初心者向けに説明します。
